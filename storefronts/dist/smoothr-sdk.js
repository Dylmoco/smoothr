import{supabase as d}from"./shared/supabase/browserClient.js";const f=document.currentScript||document.getElementById("smoothr-sdk"),h=f?.getAttribute?.("data-store-id")||f?.dataset?.storeId;window.SMOOTHR_CONFIG=window.SMOOTHR_CONFIG||{};window.SMOOTHR_CONFIG.storeId=h;console.log("[Smoothr SDK] Initialized storeId:",h);h||console.warn("[Smoothr SDK] No storeId found â€” auth metadata will be incomplete");const x=[{name:"abandonedCart",path:"./abandoned-cart/index.js"},{name:"affiliates",path:"./affiliates/index.js"},{name:"analytics",path:"./analytics/index.js"},{name:"currency",path:"./currency/index.js"},{name:"dashboard",path:"./dashboard/index.js"},{name:"discounts",path:"./discounts/index.js"},{name:"cart",path:"./cart.js"},{name:"orders",path:"./orders/index.js"},{name:"returns",path:"./returns/index.js"},{name:"reviews",path:"./reviews/index.js"},{name:"subscriptions",path:"./subscriptions/index.js"},{name:"authModule",path:"./auth/index.js",exports:["initAuth"]},{name:"stripeGateway",path:"../checkout/gateways/stripe.js"},{name:"liveRates",path:"./currency/live-rates.js",exports:["fetchExchangeRates"]},{name:"addToCart",path:"./cart/addToCart.js",exports:["initCartBindings"]},{name:"renderCartModule",path:"./cart/renderCart.js",exports:["renderCart"]},{name:"webflowDom",path:"../platforms/webflow/webflow-dom.js",exports:["setSelectedCurrency"]},{name:"cmsCurrencyModule",path:"./currency/cms-currency.js",exports:["setSelectedCurrency"]}],b={};for(const{name:n,path:r,exports:s}of x)try{const o=await import(r);if(b[n]=o,s)for(const i of s)typeof o[i]>"u"&&console.warn(`[Smoothr SDK] ${n} missing expected export "${i}"`)}catch(o){console.error(`[Smoothr SDK] Failed to load ${n} from ${r}`,o)}const{abandonedCart:I,affiliates:R,analytics:M,currency:a,dashboard:T,discounts:j,cart:O,orders:u,returns:_,reviews:v,subscriptions:D,authModule:y,stripeGateway:g,liveRates:F,addToCart:G,renderCartModule:N,webflowDom:H,cmsCurrencyModule:k}=b,c=y?.default||y,{fetchExchangeRates:S}=F||{},{initCartBindings:l}=G||{},{renderCart:C}=N||{},{setSelectedCurrency:B}=H||{},{setSelectedCurrency:E}=k||{};async function K(n){const{data:r,error:s}=await d.from("public_store_settings").select("*").eq("store_id",n).single();if(s)throw s;window.SMOOTHR_CONFIG={...window.SMOOTHR_CONFIG||{},...r||{}},"api_base"in window.SMOOTHR_CONFIG&&!window.SMOOTHR_CONFIG.apiBase&&(window.SMOOTHR_CONFIG.apiBase=window.SMOOTHR_CONFIG.api_base),window.SMOOTHR_CONFIG.storeId=n}const A=typeof process<"u"&&"https://lpuqrzvokroazwlricgn.functions.supabase.co/proxy-live-rates"||"https://lpuqrzvokroazwlricgn.functions.supabase.co/proxy-live-rates",U={abandonedCart:I,affiliates:R,analytics:M,currency:a,dashboard:T,discounts:j,cart:O,orders:u,returns:_,reviews:v,subscriptions:D,auth:c,checkout:g};(async function(){typeof globalThis.setSelectedCurrency!="function"&&(globalThis.setSelectedCurrency=()=>{});const r=window.SMOOTHR_CONFIG.storeId;if(console.log("[Smoothr SDK] Bootstrap triggered",{storeId:r}),!r)throw new Error("Missing data-store-id on <script> tag");try{await K(r)}catch(e){throw typeof process<"u",e}const s=typeof window<"u"&&window.SMOOTHR_CONFIG?.debug,o=(...e)=>s&&console.log("[Smoothr SDK]",...e);o("Smoothr SDK loaded");let i=B;if(typeof window<"u"){const e=window.SMOOTHR_CONFIG;if(typeof document<"u"&&typeof document.createElement=="function"&&!document.querySelector("#smoothr-card-styles")){const t=document.createElement("style");t.id="smoothr-card-styles",t.textContent=`[data-smoothr-card-number],
[data-smoothr-card-expiry],
[data-smoothr-card-cvc]{display:block;position:relative;}
iframe[data-accept-id]{display:block!important;}`,document.head.appendChild(t)}e.baseCurrency&&a.setBaseCurrency(e.baseCurrency),e.rates&&a.updateRates(e.rates);const m=e.baseCurrency||a.baseCurrency,w=e.rates?Object.keys(e.rates):Object.keys(a.rates),p=e.rateSource||A;if(e.debug){let t=p;/[?&]base=/.test(t)||(t+=(t.includes("?")?"&":"?")+`base=${encodeURIComponent(m)}`),/[?&]symbols=/.test(t)||(t+=(t.includes("?")?"&":"?")+`symbols=${w.join(",")}`),o("smoothr:live-rates-url",t)}typeof S=="function"?S(m,w,e.rateSource||p).then(t=>{t&&(a.updateRates(t),e.debug&&o("smoothr:live-rates",t))}).catch(()=>{}):console.warn("[Smoothr SDK] fetchExchangeRates is not available"),e.platform==="cms"&&(i=E),window.Smoothr=U,window.smoothr=window.smoothr||{},window.smoothr.auth=c,window.smoothr.supabase=d,window.smoothr.getSession=()=>d.auth.getSession(),window.smoothr.getUser=()=>d.auth.getUser(),window.renderCart=C,o("ðŸŽ¨ renderCart registered in SDK"),window.Smoothr.cart={...O,...window.Smoothr.cart||{}},window.Smoothr.cart.renderCart=C,window.Smoothr.checkout=g,window.initCartBindings=l,document.addEventListener("DOMContentLoaded",()=>{o("âœ… DOM ready â€“ calling initCartBindings"),typeof l=="function"?l():console.warn("[Smoothr SDK] initCartBindings is not available")}),c?.initAuth?c.initAuth().then(()=>{window.smoothr?.auth?.user?.value&&u?.renderOrders&&u.renderOrders()}):console.warn("[Smoothr SDK] auth.initAuth is not available"),globalThis.setSelectedCurrency=globalThis.setSelectedCurrency||i}})();export{I as abandonedCart,R as affiliates,M as analytics,c as auth,O as cart,g as checkout,a as currency,T as dashboard,U as default,j as discounts,u as orders,_ as returns,v as reviews,D as subscriptions};
